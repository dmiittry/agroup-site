{% extends 'base.html' %}
{% load static %}

{% block title %}
  Редактировать профиль водителя
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Находим все поля с классом 'datepicker-input'
      document.querySelectorAll('.datepicker-input').forEach(function (element) {
        new AirDatepicker(element, {
          autoClose: true, // Автоматически закрывать после выбора даты
          position: 'bottom right', // Позиция календаря
          dateFormat: 'dd.MM.yyyy' // Формат даты
        })
      })
    })
  </script>
{% endblock %}

{% block main %}
  {% include 'partials/preloader.html' %}
  {% include 'partials/header.html' %}

  <div class="container bg-light" style="padding-top: 140px; padding-bottom: 100px;">
    <main>
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="{% static 'img/ag/logo.png' %}" alt="Логотип" width="72" />
        <h2 class="h3" style="color: #22356F;">Редактирование профиля водителя</h2>
        <p class="lead text-muted">Пожалуйста, проверьте и при необходимости обновите ваши личные данные.</p>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-10">
          <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}

            <!-- Блок 1: Основная информация -->
            <h4 class="mb-3">Основная информация</h4>
            <div class="row g-3">
              <div class="col-md-8">
                <label for="{{ form.full_name.id_for_label }}" class="form-label">{{ form.full_name.label }}</label>
                {{ form.full_name }}
              </div>
              <div class="col-md-4">
                <label for="{{ form.birth_date.id_for_label }}" class="form-label">{{ form.birth_date.label }}</label>
                <div class="input-group">
                  <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16">
                      <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" />
                      <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>
                  </span>
                  {{ form.birth_date }}
                </div>
              </div>
              <div class="col-md-6">
                <label for="{{ form.driver_license.id_for_label }}" class="form-label">{{ form.driver_license.label }}</label>
                {{ form.driver_license }}
              </div>
              <div class="col-md-6">
                <label for="{{ form.vy_date.id_for_label }}" class="form-label">{{ form.vy_date.label }}</label>
                <div class="input-group">
                  <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16">
                      <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" />
                      <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>
                  </span>
                  {{ form.vy_date }}
                </div>
              </div>
              <div class="col-md-6">
                <label for="{{ form.snils.id_for_label }}" class="form-label">{{ form.snils.label }}</label>
                {{ form.snils }}
              </div>
            </div>

            <hr class="my-4" />

            <!-- Блок 2: Паспортные данные -->
            <h4 class="mb-3">Паспортные данные</h4>
            <div class="row g-3">
              <div class="col-12">
                <label for="{{ form.issued_by.id_for_label }}" class="form-label">{{ form.issued_by.label }}</label>
                {{ form.issued_by }}
              </div>
              <div class="col-md-4">
                <label for="{{ form.series.id_for_label }}" class="form-label">{{ form.series.label }}</label>
                {{ form.series }}
              </div>
              <div class="col-md-4">
                <label for="{{ form.number.id_for_label }}" class="form-label">{{ form.number.label }}</label>
                {{ form.number }}
              </div>
              <div class="col-md-4">
                <label for="{{ form.issue_date.id_for_label }}" class="form-label">{{ form.issue_date.label }}</label>
                <div class="input-group">
                  <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16">
                      <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" />
                      <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>
                  </span>
                  {{ form.issue_date }}
                </div>
              </div>
              <div class="col-12">
                <label for="{{ form.registration.id_for_label }}" class="form-label">{{ form.registration.label }}</label>
                {{ form.registration }}
              </div>
            </div>

            <hr class="my-4" />

            <!-- Блок 3: Контактные данные -->
            <h4 class="mb-3">Контактные телефоны</h4>
            <div class="row g-3">
              <div class="col-md-4">
                <label for="{{ form.phone_1.id_for_label }}" class="form-label">{{ form.phone_1.label }}</label>
                {{ form.phone_1 }}
              </div>
              <div class="col-md-4">
                <label for="{{ form.phone_2.id_for_label }}" class="form-label">{{ form.phone_2.label }}</label>
                {{ form.phone_2 }}
              </div>
              <div class="col-md-4">
                <label for="{{ form.phone_3.id_for_label }}" class="form-label">{{ form.phone_3.label }}</label>
                {{ form.phone_3 }}
              </div>
            </div>

            <hr class="my-4" />

            <!-- Блок 4: Фотографии документов -->
            <h3>Фотоальбом</h3>
            <div class="row">
              {% for photo in profile.photos.all %}
                <div class="col-4 mb-3">
                  <img src="{{ photo.image.url }}" alt="" class="img-thumbnail" style="max-width:140px;">
                  <div class="small text-muted">{{ photo.description }}</div>
                </div>
              {% empty %}
                <div class="col">Нет фотографий</div>
              {% endfor %}
            </div>
            {% if profile.status == "approved" %}
              <a href="{% url 'add_driver_photo' %}" class="btn btn-secondary">Добавить фото</a>
            {% endif %}

            <hr class="my-4" />

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary btn-lg">Отмена</a>
              <button class="btn btn-primary btn-lg" type="submit" style="background-color: #22356F; border-color: #22356F;">Сохранить изменения</button>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>

  <!-- Стили для видимых рамок у полей ввода -->
  <style>
    .form-control,
    .form-select {
      /* Задаем видимую рамку по умолчанию */
      border: 1px solid #ced4da;
    }
    .form-control:focus,
    .form-select:focus {
      /* При нажатии делаем рамку ярче и добавляем тень */
      border-color: #22356f;
      box-shadow: 0 0 0 0.25rem rgba(34, 53, 111, 0.15);
    }
  </style>
{% endblock %}
